"use strict";$(function(){var u=[];$.ajax({type:"post",async:!0,url:"../api/goodsCar.php",success:function(e){JSON.parse(e).map(function(e){return u.unshift(e),function(e){var t=["list_chk","list_con","list_info","list_price","list_amount","list_sum","list_op"],s=document.createElement("ul");$(s).addClass("order_lists"),$(s).attr("data-id",e.goodId);var a=document.createElement("li");$(a).addClass(t[0]),$(a).html(' <input type="checkbox" id="checkbox_2" class="son_check">');var c=document.createElement("li");$(c).addClass(t[1]),$(c).html('<div class="list_img"><a href="javascript:;"><img src="../'+e.url+'" alt=""></a></div><div class="list_text "><a href="javascript:;">'+e.title+"</a></div>");var i=document.createElement("li");$(i).addClass(t[2]),""!=e.color||""!=e.size?$(i).html(" <p>规格：颜色大小</p><p>尺寸："+(e.size+e.color)+"</p>"):$(i).html(" <p>规格：默认</p><p>尺寸：16*16*3(cm) 白色</p>");var r=document.createElement("li");$(r).addClass(t[3]),$(r).html(' <p class="price">￥'+e.price+"</p>");var n=document.createElement("li");$(n).addClass(t[4]),$(n).html('<div class="amount_box">\n                        <a href="javascript:;" class="reduce reSty">-</a>\n                        <input type="text" value="'+e.qty+'" class="sum">\n                        <a href="javascript:;" class="plus">+</a>\n                    </div>');var l=document.createElement("li");$(l).addClass(t[5]),$(l).html('<p class="sum_price">￥'+(e.price*e.qty).toFixed(2)+"</p>");var o=document.createElement("li");$(o).addClass(t[6]),$(o).html(' <p class="del"><a href="javascript:;" class="delBtn">移除商品</a></p>'),$(s).append(a),$(s).append(c),$(s).append(i),$(s).append(r),$(s).append(n),$(s).append(l),$(s).append(o),$(".order_content").append(s)}(u[0])}),$(".order_content").on("click","a",function(){$(this).css("text-decoration","none")}),$(".order_lists").css({margin:0,"padding-top":"10px"}),$.ajax({type:"get",async:!0,url:"../api/showHistory_render.php",success:function(e){JSON.parse(e).map(function(e,t){var s=document.createElement("li");$(s).attr("data-idx",t);var a=document.createElement("img");a.src="../"+e.url,$(a).css({width:"228px",height:"228px",padding:"10px"});var c=$('<p><a href="#">'+e.title+"</a></p><p>￥ "+e.currentPrice+" <del>￥ "+e.originPrice+'</del><span class="addCar fr">加入购物袋</span></p>');s.appendChild(a),$(s).append(c),$(".carShowGood").append(s)});var t=1,s=$(".carShowGoodBox"),a=s.find(".carShowGood");v_width=s.width(),p_count=Math.ceil(s.find("li").size()/5),$(".leftBtn").click(function(){a.is(":animated")||(1==t?t=1:(a.animate({left:"+="+v_width},"3000"),console.log(a.css("right")),t--))}),$(".rightBtn").click(function(){a.is(":animated")||(t==p_count?t=3:(a.animate({left:"-="+v_width},"3000"),t++))})}});var t=$('input[type="checkbox"]'),s=$(".whole_check"),a=$(".whole_check2"),c=$(".cartBox"),i=$(".shopChoice"),r=$(".son_check");t.click(function(){$(this).is(":checked")?$(this).next("label").addClass("mark"):$(this).next("label").removeClass("mark")}),s.click(function(){var e=c.find('input[type="checkbox"]');a.prop("checked",$(this).prop("checked")),$(this).is(":checked")?(e.prop("checked",!0),e.next("label").addClass("mark")):(e.prop("checked",!1),e.next("label").removeClass("mark")),m()}),a.click(function(){s.prop("checked",$(this).prop("checked"));var e=c.find('input[type="checkbox"]');$(this).is(":checked")?(e.prop("checked",!0),e.next("label").addClass("mark")):(e.prop("checked",!1),e.next("label").removeClass("mark")),m()}),r.each(function(){$(this).click(function(){if($(this).is(":checked")){var e=r.length,t=0;r.each(function(){$(this).is(":checked")&&t++}),t==e&&(s.prop("checked",!0),a.prop("checked",!0),s.next("label").addClass("mark"))}else s.prop("checked",!1),a.prop("checked",!1),s.next("label").removeClass("mark")})}),i.each(function(){$(this).click(function(){if($(this).is(":checked")){var e=i.length,t=0;i.each(function(){$(this).is(":checked")&&t++}),t==e&&(s.prop("checked",!0),a.prop("checked",!0),s.next("label").addClass("mark")),$(this).parents(".cartBox").find(".son_check").prop("checked",!0),$(this).parents(".cartBox").find(".son_check").next("label").addClass("mark")}else s.prop("checked",!1),a.prop("checked",!1),s.next("label").removeClass("mark"),$(this).parents(".cartBox").find(".son_check").prop("checked",!1),$(this).parents(".cartBox").find(".son_check").next("label").removeClass("mark");m()})}),c.each(function(){var s=$(this).find(".son_check");s.each(function(){$(this).click(function(){if($(this).is(":checked")){var e=s.length,t=0;s.each(function(){$(this).is(":checked")&&t++}),t==e&&($(this).parents(".cartBox").find(".shopChoice").prop("checked",!0),$(this).parents(".cartBox").find(".shopChoice").next("label").addClass("mark"))}else $(this).parents(".cartBox").find(".shopChoice").prop("checked",!1),$(this).parents(".cartBox").find(".shopChoice").next("label").removeClass("mark");m()})})});var n=$(".plus"),l=$(".reduce"),o=$(".sum");n.click(function(){var e=$(this).prev("input"),t=parseInt(e.val())+1,s=$(this).parents(".amount_box").find(".reduce"),a=$(this).parents(".order_lists").find(".sum_price"),c=t*$(this).parents(".order_lists").find(".price").html().slice(1);e.val(t),a.html("￥"+c.toFixed(2)),1<e.val()&&s.hasClass("reSty")&&s.removeClass("reSty"),m()}),l.click(function(){var e=$(this).next("input"),t=parseInt(e.val())-1,s=$(this).parents(".order_lists").find(".sum_price"),a=t*$(this).parents(".order_lists").find(".price").html().slice(1);1<e.val()&&(e.val(t),s.html("￥"+a.toFixed(2))),1!=e.val()||$(this).hasClass("reSty")||$(this).addClass("reSty"),m()}),o.keyup(function(){var e,t=$(this).parents(".order_lists").find(".sum_price"),s=$(this).parents(".order_lists").find(".price").html(),a=0;""==$(this).val()&&$(this).val("1"),$(this).val($(this).val().replace(/\D|^0/g,"")),a=(e=$(this).val())*s.slice(1),$(this).attr("value",e),t.html("￥"+a.toFixed(2)),m()});var d=null,p="";function h(){$(".model_bg").fadeOut(300),$(".my_model").fadeOut(300)}function m(){var s=0,a=0,e=$(".calBtn a");r.each(function(){if($(this).is(":checked")){var e=Number($(this).parents(".order_lists").find(".sum_price").html().substring(1)),t=Number($(this).parents(".order_lists").find(".sum").val());s+=e,a+=t}}),$(".total_text").html("￥"+s.toFixed(2)),$(".piece_num").html(a),0!=s&&0!=a?e.hasClass("btn_sty")||e.addClass("btn_sty"):e.hasClass("btn_sty")&&e.removeClass("btn_sty")}$(".delBtn").click(function(){d=$(this).parents(".order_lists"),p=d.parents(".order_content"),$(".model_bg").fadeIn(300),$(".my_model").fadeIn(300);var e=$(this).closest("ul").attr("data-id");$(".dialog-sure").click(function(){d.remove(),null!=p.html().trim()&&0!=p.html().trim().length||p.parents(".cartBox").remove(),h(),r=$(".son_check"),m(),$.ajax({type:"GET",async:!0,url:"../api/shopCarRemove.php",data:"goodId="+e,success:function(e){}})})}),$(".closeModel").click(function(){h()}),$(".dialog-close").click(function(){h()}),$(".delAll").click(function(e){e.preventDefault(),$order_allLists=$(":checked").closest(".order_lists"),console.log($order_allLists);var t=$order_allLists.length;if(confirm("是否确认删除所有勾选的商品？")){$order_allLists.remove(),r=$(".son_check"),m();for(var s=0;s<t;s++){var a=$order_allLists.eq(s).attr("data-id");$.ajax({type:"GET",async:!0,url:"../api/shopCarRemove.php",data:"goodId="+a})}}})}})});